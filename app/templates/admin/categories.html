{% extends 'base.html' %}
{% block content %}
<h2>Manage Categories</h2>
<form method="post">
  {{ form.hidden_tag() }}
  <div class="grid">
    <label>{{ form.group.label }} {{ form.group() }}</label>
    <label>{{ form.name.label }} {{ form.name() }}</label>
  </div>
  {{ form.submit(class="contrast") }}
</form>

<hr/>

<table>
  <thead>
    <tr>
      <th>Group</th>
      <th>Name</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
  {% for cat in categories %}
    <tr>
      <td>{{ cat.group }}</td>
      <td>{{ cat.name }}</td>
      <td>
        <a href="{{ url_for('admin.category_edit', category_id=cat.id) }}" role="button" class="secondary outline">Edit</a>
        <form method="post" action="{{ url_for('admin.category_delete', category_id=cat.id) }}" style="display: inline-block; margin-left: 0.5rem;" onsubmit="return confirm('Are you sure you want to delete this category?');">
          {{ csrf_form.hidden_tag() }}
          <button type="submit" class="secondary outline">Delete</button>
        </form>
      </td>
    </tr>
  {% else %}
    <tr>
      <td colspan="3" class="muted">No categories created yet.</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<hr/>
<section id="export-categories">
    <h3>Export for .env</h3>
    <p>Copy the line below and add it to your <code>.env</code> file to use these categories for future seeding.</p>
    <article>
        <textarea id="categories-json" readonly style="width: 100%; white-space: pre; overflow-x: auto;">{{ categories_json_string }}</textarea>
        <button id="copy-button" class="outline">Copy to Clipboard</button>
    </article>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const copyButton = document.getElementById('copy-button');
    const jsonTextarea = document.getElementById('categories-json');

    copyButton.addEventListener('click', function() {
        jsonTextarea.select();
        document.execCommand('copy');

        // Provide user feedback
        const originalText = copyButton.innerText;
        copyButton.innerText = 'Copied!';
        setTimeout(() => {
            copyButton.innerText = originalText;
        }, 2000);
    });
});
</script>
{% endblock %}